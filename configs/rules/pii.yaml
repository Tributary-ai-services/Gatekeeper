# PII Detection Patterns
# Gatekeeper - TAS Gatekeeper Library

version: "1.0"
name: "pii"
description: "Personally Identifiable Information detection patterns"

patterns:
  # Social Security Number
  - id: "ssn"
    name: "Social Security Number"
    type: "pii"
    severity: "critical"
    description: "US Social Security Number"
    regex: '\b(?!000|666|9\d{2})\d{3}[-\s]?(?!00)\d{2}[-\s]?(?!0000)\d{4}\b'
    validation:
      type: "ssn"
      rules:
        - "first_three_not_000_666_9xx"
        - "middle_two_not_00"
        - "last_four_not_0000"
    confidence_boost:
      formatted: 0.2  # Boost if has dashes/spaces
    examples:
      - "123-45-6789"
      - "123 45 6789"
      - "123456789"
    risk_base: 0.9

  # Credit Card Numbers
  - id: "credit_card"
    name: "Credit Card Number"
    type: "pii"
    severity: "critical"
    description: "Credit card number (Visa, MasterCard, Amex, Discover)"
    regex: '\b(?:4[0-9]{12}(?:[0-9]{3})?|5[1-5][0-9]{14}|3[47][0-9]{13}|6(?:011|5[0-9]{2})[0-9]{12})\b'
    validation:
      type: "luhn"
    confidence_boost:
      formatted: 0.1
    bin_patterns:
      visa: "^4"
      mastercard: "^5[1-5]"
      amex: "^3[47]"
      discover: "^6(?:011|5)"
    examples:
      - "4111111111111111"
      - "5555555555554444"
      - "378282246310005"
    risk_base: 0.9

  # Email Address
  - id: "email"
    name: "Email Address"
    type: "pii"
    severity: "medium"
    description: "Email address"
    regex: '\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b'
    validation:
      type: "email"
    examples:
      - "user@example.com"
      - "john.doe@company.org"
    risk_base: 0.4

  # Phone Number (US)
  - id: "phone_number"
    name: "Phone Number"
    type: "pii"
    severity: "medium"
    description: "US phone number in various formats"
    regex: '\b(?:\+?1[-.\s]?)?\(?([0-9]{3})\)?[-.\s]?([0-9]{3})[-.\s]?([0-9]{4})\b'
    confidence_boost:
      formatted: 0.1
    examples:
      - "(555) 123-4567"
      - "555-123-4567"
      - "+1-555-123-4567"
    risk_base: 0.5

  # IP Address
  - id: "ip_address"
    name: "IP Address"
    type: "pii"
    severity: "low"
    description: "IPv4 address"
    regex: '\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b'
    validation:
      type: "ip"
      rules:
        - "octets_0_255"
    examples:
      - "192.168.1.1"
      - "10.0.0.1"
    risk_base: 0.3

  # Bank Account Number
  - id: "bank_account"
    name: "Bank Account Number"
    type: "pii"
    severity: "critical"
    description: "Bank account number (US routing + account)"
    regex: '\b[0-9]{9}[-\s]?[0-9]{4,17}\b'
    validation:
      type: "aba_routing"
    examples:
      - "021000021 1234567890"
    risk_base: 0.8

  # Passport Number
  - id: "passport"
    name: "Passport Number"
    type: "pii"
    severity: "high"
    description: "US Passport number"
    regex: '\b[A-Z]{1,2}[0-9]{6,9}\b'
    examples:
      - "A12345678"
      - "AB1234567"
    risk_base: 0.8

  # Driver's License
  - id: "drivers_license"
    name: "Driver's License"
    type: "pii"
    severity: "high"
    description: "US Driver's license number (state-specific patterns)"
    patterns_by_state:
      CA: '\b[A-Z][0-9]{7}\b'
      NY: '\b[0-9]{9}\b'
      TX: '\b[0-9]{8}\b'
      FL: '\b[A-Z][0-9]{12}\b'
    examples:
      - "A1234567"  # California
      - "123456789"  # New York
    risk_base: 0.7

  # Date of Birth
  - id: "date_of_birth"
    name: "Date of Birth"
    type: "pii"
    severity: "medium"
    description: "Date of birth in various formats"
    regex: '\b(?:0?[1-9]|1[0-2])[/\-](?:0?[1-9]|[12][0-9]|3[01])[/\-](?:19|20)[0-9]{2}\b'
    examples:
      - "01/15/1990"
      - "12-25-1985"
    risk_base: 0.7

  # Physical Address
  - id: "address"
    name: "Physical Address"
    type: "pii"
    severity: "medium"
    description: "US physical/mailing address"
    regex: '\b\d+\s+[\w\s]+(?:Street|St|Avenue|Ave|Boulevard|Blvd|Road|Rd|Drive|Dr|Lane|Ln|Court|Ct|Way|Circle|Cir)\.?\s*(?:#\s*\d+|(?:Apt|Suite|Ste|Unit)\s*#?\s*\d+)?\b'
    examples:
      - "123 Main Street"
      - "456 Oak Ave, Apt 7"
    risk_base: 0.6

  # Personal Name
  - id: "name"
    name: "Personal Name"
    type: "pii"
    severity: "low"
    description: "Personal name (requires context)"
    # Name detection typically requires NER, not just regex
    use_ner: true
    examples:
      - "John Smith"
      - "Jane Doe"
    risk_base: 0.5

  # Medical Record Number
  - id: "medical_record_number"
    name: "Medical Record Number"
    type: "pii"
    severity: "critical"
    description: "Healthcare medical record number"
    regex: '\b(?:MRN|MR#|Medical Record)[:\s]*[A-Z0-9]{6,12}\b'
    examples:
      - "MRN: ABC123456"
      - "MR# 123456789"
    risk_base: 0.9
    frameworks:
      - HIPAA

  # AWS Access Key
  - id: "aws_access_key"
    name: "AWS Access Key"
    type: "credential"
    severity: "critical"
    description: "AWS Access Key ID"
    regex: '\b(?:AKIA|ABIA|ACCA|ASIA)[0-9A-Z]{16}\b'
    examples:
      - "AKIAIOSFODNN7EXAMPLE"
    risk_base: 0.95

  # AWS Secret Key
  - id: "aws_secret_key"
    name: "AWS Secret Key"
    type: "credential"
    severity: "critical"
    description: "AWS Secret Access Key"
    regex: '\b[A-Za-z0-9/+=]{40}\b'
    context_required:
      - "aws"
      - "secret"
      - "key"
    examples:
      - "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"
    risk_base: 0.95

  # API Key (Generic)
  - id: "api_key"
    name: "API Key"
    type: "credential"
    severity: "high"
    description: "Generic API key pattern"
    regex: '\b(?:api[_-]?key|apikey|api[_-]?token)["\s:=]+["\']?([A-Za-z0-9_\-]{20,64})["\']?\b'
    examples:
      - 'api_key="abc123def456..."'
    risk_base: 0.85
